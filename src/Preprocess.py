from nltk import sent_tokenize
from nltk.corpus import stopwords
from nltk.stem import WordNetLemmatizer
from sklearn.feature_extraction.text import CountVectorizer
from nltk.tokenize import RegexpTokenizer

class Preprocess:
    def __init__(self,doc):
        self.englishStopWords = set(stopwords.words('english'))
        self.englishStopWords.update(['.', ',', '"', "'", '?', '!', ':', ';', '(', ')', '[', ']', '{', '}', '-','m'])
        self.wordTokenizer = RegexpTokenizer(r'\w+')
        self.lemmatizer = WordNetLemmatizer()
        self.lemmatizedVectorizer = CountVectorizer(preprocessor=self.preProcess)
        self.featurevector = self.getFeatureVector(doc)
        self.indextoword = list({v: str(k) for k, v in self.lemmatizedVectorizer.vocabulary_.iteritems()}.values())

    def tokenizeAndLemmatize(self, word):
        return self.lemmatizer.lemmatize(word.lower())

    def preProcess(self,s):
        return  " ".join(filter(lambda w : w not in self.englishStopWords, map(self.tokenizeAndLemmatize, self.wordTokenizer.tokenize(s))))

    def lemmatizedWords(self, doc):
        return (self.lemmatizer.lemmatize(word) for word in self.analyzer(doc))

    def getFeatureVector(self, doc):
        self.originalSentences = sent_tokenize(doc)
        #print originalSentences
        return self.lemmatizedVectorizer.fit_transform(self.originalSentences)

if __name__ == '__main__':
    doc = """MEXICAN blue wing butterflies defy stereotype. They prefer shade to sunlight. They are dark, not bright. They seek tree bark, rather than blooms. And they are one of the reasons Mel and Maris Midgley traveled from Gloucestershire, England, to southern Texas and the Lower Rio Grande Valley.''You can walk right up to them,'' said Ms. Midgley as she displayed a vivid image of the blue wing on her digital camera. ''You can't do that with a bird.''Indeed, it is the kingfishers, green jays, kiskadees and other birds that thrive along the Rio Grande that make this 275-mile stretch of the river a prime destination for nature lovers. Some 500 bird species have been sighted in the four-county region, making it the most concentrated area in the United States for birds, according to experts. To a growing number of eco-tourists, the region is also the center of butterflying. Of the 700 varieties found in the United States, 300 alight here.As rich as the region is for birders and butterfliers, some naturalists say the area is now threatened because of the border fence legislation signed in late October by President Bush to help curb illegal immigration. The details on just what such a fence would look like have not been made public yet, but environmentalists and people who depend on nature tourism, which brings an estimated $125 million to the area annually, are concerned.''A physical fence on the river doesn't make sense because the river is so winding, and it would eliminate the last remnant of the native riparian forest down here,'' said Keith Hackland, a local naturalist, noting that in some places the green corridor is only 50 to 100 feet wide. ''Even if birds and butterflies could fly over, they would have nowhere to fly to.''Possible threats to the environment notwithstanding, the North American Butterfly Association is continuing to expand its flagship butterfly park in the Lower Rio Grande Valley town of Mission. ''This is the only place they could put a park like this,'' said Sue Sill, executive director of the park, which opened in 2002. ''We have butterflies 12 months of the year and see more butterflies than anywhere else.''Monarchs and the similar species known as queens, crepe-paperlike yellow sulfurs, large black swallowtails and ornate red admirals swarm the five-foot-tall purple-flowered crucita bushes that have been planted on five acres of rehabilitated cotton and sorghum fields at the NABA International Butterfly Park. In the next two years, the organization expects to build a visitors' center designed by architect Wendy Evans Joseph and to replant more of the 100 acres it has acquired for the park. Already it's a destination for butterfliers like the Midgleys, who are former birders.''Most birders appreciate beautiful things. It's easy to turn them onto something like this,'' Mr. Midgley said. ''And you don't have to get up as early.''Whereas birding is usually best at dawn and dusk, midday is prime time for viewing heat-loving butterflies. Late fall and winter are high season in southern Texas because butterfly migration and greater rainfall help the flowers that provide food for many species. Any butterfly safari here inevitably involves sharing the wild with birders, as my 7-year-old son, Seth, and I discovered in November. We signed up for a canoe trip on the Rio Grande along a stretch protected by the Santa Ana National Wildlife Refuge with Mr. Hackland and Cheryl Longton, a park volunteer guide.''There are so many butterflies now it's distracting,'' Ms. Longton said as we passed the park's butterfly garden.''That makes it hard to bird,'' said Allison Hilf, a birder from Denver in the group.THE rio might have once been grand, but dams upriver have narrowed it considerably, to less than 200 feet wide in some places and as shallow as a foot in parts. Still, as the river wound through native forest of old-growth oaks festooned in Spanish moss and banks of tall riverside reeds, it seemed exotic beside the fields of kale and cabbage that bordered the reserve. Herons -- great blue, tricolored, green and night -- perched on downed limbs and flew away only when we came too near. Green and ringed kingfishers crisscrossed our canoes. There were periods of manic activity, when hundreds of dragonflies would patrol the river or flocks of swallows would swoop at insect hatches. Where flowering vines cascaded down from the trees, butterflies perched, warming their wings in the morning sun.Hot-orange Julias and the cloisonn underwings of gulf fritillaries stood out boldly against the foliage, while small, brown American snouts and pale white peacocks hovered over the water.''Temperate meets tropical here, both in terms of vegetation and climate,'' Mr. Hackland said, noting that the Fish and Wildlife Service has identified 11 distinct biological communities in the region. ''Butterflies are a good indicator of that. You don't get great varieties without diverse vegetation. We have huge diversity here, including semidesert, riparian tropical forest, freshwater and saltwater. It's biologically one of the most diverse areas in the United States.''An emerald green malachite butterfly, the kind of quarry butterfliers buzz about, flew over our van as it crested the levee, towing the canoes back to the visitors' center. ''This is what the rest of Texas looks like,'' Ms. Longton said, indicating the flat fields opposite the levee. ''Only 5 percent of the natural habitat is left.''The Santa Ana refuge is part of a larger plan by Fish and Wildlife to string together nature preserves along the river to provide a wildlife corridor not only for birds and butterflies but for the endangered ocelot and other native animals. So far, 40,000 acres of the Lower Rio Grande Valley National Wildlife Refuge are open to the public en route to an envisioned 132,500 acres bordering the final 275 miles of the river from Falcon Dam south to the Gulf of Mexico. But the entire project, critics say, is threatened by the proposed immigration fence.''Most people here are against it for social reasons. You don't want to put up a fence to keep out the neighbors,'' said Martin Hagne, director of the Valley Nature Center in Weslaco. ''It could wipe out all that habitat it has taken 20 years to develop.''While specific designs for the fence remain a mystery, the Secure Fence Act calls for it to be completed by 2008 and for the Lower Rio Grande Valley portion to run from Laredo to Brownsville.Jarrod Agen, a spokesman in Washington for the Department of Homeland Security, said yesterday that the agency would consider the concerns of environmentalists in any decision about the form of the wall, adding that cameras and sensors might prove more effective in a rural area. ''We are looking at a mix of physical barriers as well as technology to have have full surveillance of the border,'' he said.Mr. Hagne and some other environmentalists are hoping the barrier will indeed be some type of virtual fence made up of electronic surveillance devices that would preserve the habitat, rather than a solid wall or fence, which, if built on the shore, might require clearing vegetation for patrol paths.In one of the nation's fastest growing regions, eco-advocates already fight developers and agricultural interests for space. Butterflying and birding there require hopscotching from one nature preserve to the next in a central core of communities over 30 miles, from Mission in the west to Weslaco in the east, with the busy McAllen at the center. Vast farm fields and RV parks buffer sights that include the Edinburg Scenic Wetlands, the Valley Nature Center, Quinta Mazatlan and Bentsen-Rio Grande Valley State Park, where we attended an evening ''owl prowl'' in search of nocturnal black witch moths and foraging javalina.We found the navigating a do-it-yourselfers' dream, but the education was far greater when joined by Mr. Hackland, who correctly identified the least grebes, which we took for small ducks, differentiated the tawny emperor butterfly from the white peacock and picked out a great barbecue joint, Willie's, near Santa Ana.Meanwhile, the local interest in wild things is expanding from birds to butterflies and, lately, to dragonflies. ''People start out with birds,'' observed Shane Mooneyham, a naturalist at Estero Llano Grande State Park in Weslaco, where we spot a bright red Needham's skimmer dragonfly in addition to a swallowtail butterfly. ''When they've seen all they can see, they go to butterflies. Then, dragonflies. It's the next natural pretty insect.''ON THE WINGIt's Always Butterflying TimeAMERICAN, Continental and Delta offer connecting service to McAllen/Miller International Airport, the most convenient airport in the Lower Rio Grande Valley. A car is essential for getting around. A four-day compact rental from Avis is about $75.Renaissance Casa de Palmas Hotel (101 North Main Street, McAllen; 956-631-1101; www.renaissancemcallen.com) has rooms from $99. The Alamo Inn (801 Main Street, Alamo; 956-782-9912; www.alamoinnsuites.com; rooms from $55, though lower rates may be available) is run by Keith Hackland, a naturalist who serves as a guide for $200 a day.Patos, tacos built to order, start at $1.19 each at El Pato (3019 North 10th Street, McAllen; 956-682-1576).The Original Willie's Bar-B-Que (320 South Alamo Road, Alamo; 956-702-1370) offers smoky barbecue pork, chicken and beef from $6.50 a plate.Fajitas ($8.95) are a specialty at El Dorado Restaurant (755 Main Street, Alamo; 956-787-8822).The Blue Onion (423 South International Boulevard, Weslaco; 956-447-0067) has flatbreads from $4 and creative entree salads ($8).Bentsen-Rio Grande Valley State Park (956-585-1107) is at 280 South Bentsen Palm Drive in Mission.Edinburg Scenic Wetlands (956-381-9922) is at 714 South Raul Longoria in Edinburg.Estero Llano Grande State Park (956-565-3919) is at 154A Lakeview Drive, Weslaco.NABA International Butterfly Park (956-583-9009) is at 3400 South Butterfly Park Drive, Mission.Quinta Mazatlan (956-688-3370) is at 600 Sunset Avenue, McAllen.Santa Ana National Wildlife Refuge on Highway 281 near Alamo (956-787-7861) offers canoe trips November through April at $20 a person.Valley Nature Center (956-969-2475) is at 301 South Border Avenue, Weslaco.Correction:  January 19, 2007, Friday  An article last Friday about observing butterflies in the Lower Rio Grande Valley misstated the trees that are hung with Spanish moss there. Many indigenous trees, including species of elm and ash, have Spanish moss there, but oaks are not among them."""
    preprocess = Preprocess(doc)
    #cvf = preprocess.getFeatureVector(doc)
    print preprocess.lemmatizedVectorizer.vocabulary_
    print preprocess.indextoword
    #print cvf
    #print cvf.getrow(0)
    # print preprocess.lemmatizedVectorizer.vocabulary_
    # print preprocess.englishStopWords



